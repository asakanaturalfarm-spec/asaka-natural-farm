<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>管理画面 | 安積直売所</title>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@400;500;700&display=swap" rel="stylesheet">
    <!-- Supabase CDN -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2.39.7/dist/umd/supabase.js"></script>
    <!-- Supabase初期化はasaka-hub.jsで行われます。supabaseUrlとsupabaseKeyを適切に設定してください。-->
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Noto Sans JP', sans-serif;
            background: linear-gradient(135deg, #2c5f2d 0%, #3a7f3b 100%);
            min-height: 100vh;
            display: flex;
            align-items: center;
            padding: 20px;
        }
        
        .container {
            max-width: 900px;
            width: 100%;
        }
        
        .header {
            text-align: center;
            color: white;
            margin-bottom: 40px;
        }
        
        .header h1 {
            font-size: 36px;
            margin-bottom: 10px;
        }
        
        .header p {
            font-size: 18px;
            opacity: 0.95;
        }
        
        .menu-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
        }
        
        .menu-card {
            background: white;
            padding: 30px;
            border-radius: 10px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            text-decoration: none;
            color: inherit;
            display: block;
        }
        
        .menu-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 12px rgba(0,0,0,0.2);
        }
        
        .menu-icon {
            font-size: 48px;
            margin-bottom: 15px;
        }
        
        .menu-title {
            font-size: 20px;
            font-weight: 700;
            margin-bottom: 10px;
            color: #2c5f2d;
        }
            <!--
        
        .menu-description {
            font-size: 14px;
            color: #666;
            line-height: 1.6;
        }
        .priority-badge {
            display: inline-block;
            background: #d32f2f;
            color: white;
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 600;
            margin-top: 10px;
        }
        
        .logout {
            text-align: center;
            margin-top: 30px;
        }
        
        .logout a {
            color: white;
            text-decoration: underline;
            font-size: 14px;
        }
        
        .stats-bar {
            background: white;
            padding: 20px;
            border-radius: 10px;
            margin-bottom: 30px;
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 20px;
        }
        
        .stat {
            text-align: center;
        }
        
        .stat-value {
            font-size: 28px;
            font-weight: 700;
            color: #2c5f2d;
        }
        
        .stat-label {
                font-size: 13px;
                color: #666;
                margin-top: 5px;
        }
        /* 管理操作ログ表示用スタイル */
        #adminLogSection {
            background: #fff;
            border-radius: 8px;
            padding: 18px 12px;
            max-width: 600px;
            margin: 32px auto 0;
            box-shadow: 0 2px 12px #00796b22;
        }
        #adminLogList {
            max-height: 320px;
            overflow-y: auto;
            font-size: 0.98em;
        }
    </style>
</head>
<body>
        <!-- 管理操作ログ表示 -->
        <div id="adminLogSection">
            <h2 style="font-size:1.05rem;color:#00796b;margin-bottom:10px;">管理操作ログ</h2>
            <div id="adminLogList"></div>
        </div>
        <div class="container">
        <div class="header">
            <h1>🛠️ 管理画面</h1>
            <p>安積直売所オンラインストア</p>
        </div>
        
        <div class="stats-bar">
            <div class="stat">
                <div class="stat-value">24</div>
                <div class="stat-label">本日の注文</div>
            </div>
            <div class="stat">
                <div class="stat-value">¥48,300</div>
                <div class="stat-label">本日の売上</div>
            </div>
            <div class="stat">
                <div class="stat-value">3</div>
                <div class="stat-label">入金待ち</div>
            </div>
            <div class="stat">
                <div class="stat-value">5</div>
                <div class="stat-label">発送待ち</div>
            </div>
        </div>
        
        <div class="menu-grid">
            <a href="admin-products.html" class="menu-card">
                <div class="menu-icon">🥬</div>
                <div class="menu-title">商品管理</div>
                <div class="menu-description">
                    商品追加・詳細記入・価格変更・商品情報編集など商品管理機能を充実
                </div>
            </a>

            <a href="admin-customers.html" class="menu-card">
                <div class="menu-icon">👥</div>
                <div class="menu-title">顧客管理</div>
                <div class="menu-description">
                    顧客一覧・問い合わせ履歴・ステータス管理・問合わせ対応など顧客対応機能を充実
                </div>
            </a>

            <a href="admin-services.html" class="menu-card">
                <div class="menu-icon">🎁</div>
                <div class="menu-title">サービス管理</div>
                <div class="menu-description">
                    クーポン作成・サービス設定・プロモーション管理
                </div>
            </a>
        </div>
        
        <div class="logout">
            <a href="shop.html">← ストアトップに戻る</a>
        </div>
    </div>
    
    <!-- MFA（二要素認証）ダイアログ -->
    <div id="mfaModal" style="display:none;position:fixed;z-index:10000;top:0;left:0;width:100vw;height:100vh;background:rgba(30,40,50,0.18);backdrop-filter:blur(2px);">
      <div style="max-width:400px;margin:80px auto 0;background:#fff;border-radius:14px;box-shadow:0 4px 32px #0002;padding:32px 24px 24px;position:relative;max-height:80vh;overflow:hidden;">
        <h2 style="font-size:1.1rem;color:#1a2a36;margin-bottom:18px;font-weight:700;letter-spacing:0.02em;">二要素認証</h2>
        <div id="mfaMessage" style="font-size:0.98rem;color:#222;line-height:1.7;margin-bottom:12px;">ご登録メールアドレス宛に認証コードを送信しました。<br>届いた6桁コードを入力してください。</div>
        <input id="mfaCodeInput" type="text" maxlength="6" pattern="[0-9]{6}" placeholder="6桁コード" style="width:100%;font-size:1.2em;padding:10px 8px;margin-bottom:12px;border-radius:8px;border:1.5px solid #26a69a;">
        <div id="mfaError" style="color:#c0392b;font-size:0.97rem;margin-bottom:10px;display:none;"></div>
        <button id="mfaSubmitBtn" class="btn btn-primary" style="width:100%;">認証して管理画面へ</button>
      </div>
    </div>
    
    <script>
        // 実際はサーバーから取得
        console.log('[管理画面] 初期化完了');
        
        // 認証チェック（実際はサーバーサイドで実装）
        function checkAdminAuth() {
            // const isAdmin = sessionStorage.getItem('admin_auth');
            // if (!isAdmin) {
            //     window.location.href = 'admin-login.html';
            // }
        }
        
        // --- MFA（二要素認証） ---
        let mfaVerified = false;
        function showMfaModal(onSuccess) {
          const modal = document.getElementById('mfaModal');
          const input = document.getElementById('mfaCodeInput');
          const error = document.getElementById('mfaError');
          modal.style.display = '';
          document.body.style.overflow = 'hidden';
          // 6桁コード生成
          const code = ('' + Math.floor(100000 + Math.random() * 900000));
          window.__lastMfaCode = code;
          // 本番用メール送信処理
          sendMfaCodeToAdmin(code);
          input.value = '';
          error.style.display = 'none';
          document.getElementById('mfaSubmitBtn').onclick = function() {
            if (input.value === code) {
              mfaVerified = true;
              modal.style.display = 'none';
              document.body.style.overflow = '';
              if (onSuccess) onSuccess();
            } else {
              error.textContent = '認証コードが正しくありません';
              error.style.display = '';
            }
          };
        }

        // 本番用メール送信（Gmail転送）
        function sendMfaCodeToAdmin(code) {
          // Gmail APIやメールサービス連携が必要
          // ここではダミーとしてalertを表示
          // 実際の運用ではサーバー側でメール送信処理を実装してください
          alert('認証コードが管理者メール（asaka.natural.farm@gmail.com）に転送されました。\nコード: ' + code);
        }
        
        // ページ読み込み時にMFA認証
        document.addEventListener('DOMContentLoaded', function() {
          if (!mfaVerified) {
            showMfaModal(() => {
              // 認証後に管理画面を表示
              document.querySelector('.container').style.display = '';
            });
            document.querySelector('.container').style.display = 'none';
          }
        });

        // --- 管理操作ログ ---
        function saveAdminLog(action, detail) {
          const logs = JSON.parse(localStorage.getItem('adminLogs') || '[]');
          logs.unshift({
            action,
            detail,
            timestamp: new Date().toISOString()
          });
          localStorage.setItem('adminLogs', JSON.stringify(logs));
        }

        function getAdminLogs() {
          return JSON.parse(localStorage.getItem('adminLogs') || '[]');
        }

        function renderAdminLogs() {
          const logs = getAdminLogs();
          const el = document.getElementById('adminLogList');
          if (!el) return;
          el.innerHTML = logs.slice(0, 30).map(log =>
                        `<div style="border-bottom:1px solid #eee;padding:6px 0;font-size:0.97em;">
                            <span style="color:#888;">${new Date(log.timestamp).toLocaleString('ja-JP')}</span>：
                            <span style="color:#00796b;font-weight:600;">${log.action}</span>
                            <span style="color:#222;">${log.detail}</span>
                        </div>`
                    ).join('');
        }

        // 初期表示でログ描画
        document.addEventListener('DOMContentLoaded', function() {
          renderAdminLogs();
        });
    </script>
</body>
</html>

