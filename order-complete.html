<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="å®‰ç©ç›´å£²æ‰€ æ³¨æ–‡å®Œäº†">
    <title>æ³¨æ–‡å®Œäº† | å®‰ç©ç›´å£²æ‰€</title>
    <link rel="stylesheet" href="style.css?v=2">
    <link href="https://fonts.googleapis.com/css2?family=Noto+Serif+JP:wght@500;700&family=Noto+Sans+JP:wght@300;400;500&display=swap" rel="stylesheet">
    <style>
        .complete-page {
            min-height: 100vh;
            background: var(--bg-cream);
            padding: 100px 40px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .complete-container {
            max-width: 800px;
            width: 100%;
            background: white;
            border-radius: 16px;
            padding: 60px;
            box-shadow: var(--shadow-md);
            text-align: center;
        }

        .success-icon {
            width: 80px;
            height: 80px;
            background: var(--primary-color);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 32px;
            animation: scaleIn 0.5s ease-out;
        }

        @keyframes scaleIn {
            from {
                transform: scale(0);
                opacity: 0;
            }
            to {
                transform: scale(1);
                opacity: 1;
            }
        }

        .success-icon svg {
            width: 40px;
            height: 40px;
            stroke: white;
            stroke-width: 3;
            fill: none;
            stroke-linecap: round;
            stroke-linejoin: round;
        }

        .complete-title {
            font-size: 36px;
            color: var(--text-dark);
            font-family: 'Noto Serif JP', serif;
            margin-bottom: 16px;
            font-weight: 600;
        }

        .complete-message {
            font-size: 16px;
            color: var(--text-medium);
            line-height: 1.8;
            margin-bottom: 40px;
        }

        .order-info {
            background: var(--bg-cream);
            border-radius: 12px;
            padding: 32px;
            margin-bottom: 40px;
            text-align: left;
        }

        .order-info-title {
            font-size: 18px;
            font-weight: 600;
            color: var(--text-dark);
            margin-bottom: 20px;
            font-family: 'Noto Serif JP', serif;
        }

        .info-row {
            display: flex;
            justify-content: space-between;
            padding: 12px 0;
            border-bottom: 1px solid var(--border-subtle);
        }

        .info-row:last-child {
            border-bottom: none;
        }

        .info-label {
            color: var(--text-medium);
            font-size: 14px;
        }

        .info-value {
            color: var(--text-dark);
            font-weight: 600;
            font-size: 14px;
        }

        .order-number {
            font-size: 24px;
            color: var(--primary-color);
            font-family: monospace;
        }

        .next-steps {
            background: rgba(61, 90, 61, 0.05);
            border-radius: 12px;
            padding: 24px;
            margin-bottom: 32px;
            text-align: left;
        }

        .next-steps h3 {
            font-size: 16px;
            font-weight: 600;
            color: var(--text-dark);
            margin-bottom: 16px;
        }

        .next-steps ul {
            list-style: none;
            padding: 0;
            margin: 0;
        }

        .next-steps li {
            padding: 8px 0;
            color: var(--text-medium);
            font-size: 14px;
            line-height: 1.6;
        }

        .next-steps li:before {
            content: "âœ“ ";
            color: var(--primary-color);
            font-weight: 600;
            margin-right: 8px;
        }

        .action-buttons {
            display: flex;
            gap: 16px;
            justify-content: center;
            flex-wrap: wrap;
        }

        .btn-primary, .btn-secondary {
            padding: 14px 32px;
            border-radius: 8px;
            font-size: 15px;
            font-weight: 600;
            text-decoration: none;
            transition: var(--transition);
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }

        .btn-primary {
            background: var(--primary-color);
            color: white;
            border: none;
        }

        .btn-primary:hover {
            background: var(--primary-dark);
            transform: translateY(-2px);
            box-shadow: var(--shadow-md);
        }

        .btn-secondary {
            background: white;
            color: var(--text-dark);
            border: 2px solid var(--border-medium);
        }

        .btn-secondary:hover {
            border-color: var(--primary-color);
            color: var(--primary-color);
        }

        .support-info {
            margin-top: 32px;
            padding-top: 32px;
            border-top: 1px solid var(--border-subtle);
            color: var(--text-light);
            font-size: 14px;
            line-height: 1.6;
        }

        .support-info a {
            color: var(--primary-color);
            text-decoration: none;
        }

        .support-info a:hover {
            text-decoration: underline;
        }

        @media (max-width: 768px) {
            .complete-page {
                padding: 60px 20px;
            }

            .complete-container {
                padding: 40px 24px;
            }

            .complete-title {
                font-size: 28px;
            }

            .action-buttons {
                flex-direction: column;
            }

            .btn-primary, .btn-secondary {
                width: 100%;
                justify-content: center;
            }
        }
    </style>
</head>
<body>
    <div class="complete-page">
        <div class="complete-container">
            <div class="success-icon">
                <svg viewBox="0 0 50 50">
                    <path d="M 10 25 L 20 35 L 40 15"></path>
                </svg>
            </div>

            <h1 class="complete-title">ã”æ³¨æ–‡ã‚ã‚ŠãŒã¨ã†ã”ã–ã„ã¾ã™ï¼</h1>
            
            <p class="complete-message">
                ã”æ³¨æ–‡ã‚’æ‰¿ã‚Šã¾ã—ãŸã€‚<br>
                ã”ç™»éŒ²ã„ãŸã ã„ãŸãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹ã«ç¢ºèªãƒ¡ãƒ¼ãƒ«ã‚’ãŠé€ã‚Šã—ã¾ã—ãŸã®ã§ã€ã”ç¢ºèªãã ã•ã„ã€‚
            </p>

            <div class="order-info">
                <h2 class="order-info-title">æ³¨æ–‡æƒ…å ±</h2>
                <div class="info-row">
                    <span class="info-label">æ³¨æ–‡ç•ªå·</span>
                    <span class="info-value order-number" id="orderNumber">-</span>
                </div>
                <div class="info-row">
                    <span class="info-label">æ³¨æ–‡æ—¥æ™‚</span>
                    <span class="info-value" id="orderDate">-</span>
                </div>
                <div class="info-row">
                    <span class="info-label">ãŠæ”¯æ‰•ã„æ–¹æ³•</span>
                    <span class="info-value" id="paymentMethod">-</span>
                </div>
                <div class="info-row">
                    <span class="info-label">ãŠå±Šã‘å…ˆ</span>
                    <span class="info-value" id="shippingAddress">-</span>
                </div>
                <div class="info-row">
                    <span class="info-label">åˆè¨ˆé‡‘é¡</span>
                    <span class="info-value" id="totalAmount">-</span>
                </div>
            </div>

            <div class="next-steps">
                <h3>ä»Šå¾Œã®æµã‚Œ</h3>
                <ul id="nextStepsList">
                    <li>æ³¨æ–‡ç¢ºèªãƒ¡ãƒ¼ãƒ«ã‚’ã”ç¢ºèªãã ã•ã„</li>
                    <li>å•†å“ã®ç™ºé€æº–å‚™ãŒæ•´ã„æ¬¡ç¬¬ã€ç™ºé€å®Œäº†ãƒ¡ãƒ¼ãƒ«ã‚’ãŠé€ã‚Šã—ã¾ã™</li>
                    <li>å•†å“ã¯é€šå¸¸2ã€œ5å–¶æ¥­æ—¥ã§ãŠå±Šã‘ã—ã¾ã™</li>
                    <li>ã”ä¸æ˜ãªç‚¹ãŒã”ã–ã„ã¾ã—ãŸã‚‰ã€ãŠæ°—è»½ã«ãŠå•ã„åˆã‚ã›ãã ã•ã„</li>
                </ul>
            </div>

            <!-- æ”¯æ‰•ã„æ–¹æ³•åˆ¥ã®è©³ç´°æƒ…å ± -->
            <div id="paymentDetails" style="display: none; background: #fff3cd; border: 2px solid #ffc107; border-radius: 12px; padding: 24px; margin-bottom: 32px; text-align: left;">
                <h3 style="font-size: 16px; font-weight: 600; color: #856404; margin-bottom: 16px;" id="paymentDetailsTitle"></h3>
                <div id="paymentDetailsContent" style="font-size: 14px; color: #856404; line-height: 1.8;"></div>
            </div>

            <div class="action-buttons">
                <a href="index.html" class="btn-primary">
                    ãƒˆãƒƒãƒ—ãƒšãƒ¼ã‚¸ã¸
                </a>
                <a href="products.html" class="btn-secondary">
                    å•†å“ä¸€è¦§ã‚’è¦‹ã‚‹
                </a>
            </div>

            <div class="support-info">
                ã”è³ªå•ã‚„ãŠå›°ã‚Šã®ã“ã¨ãŒã”ã–ã„ã¾ã—ãŸã‚‰<br>
                <a href="mailto:info@azaka-farm.com">info@azaka-farm.com</a> ã¾ã§ãŠå•ã„åˆã‚ã›ãã ã•ã„ã€‚
            </div>
        </div>
    </div>

    <script>
        // æ”¯æ‰•ã„æ–¹æ³•åˆ¥ã®è©³ç´°æƒ…å ±ã‚’è¡¨ç¤º
        function showPaymentSpecificInfo(order) {
            const paymentDetailsDiv = document.getElementById('paymentDetails');
            const paymentDetailsTitle = document.getElementById('paymentDetailsTitle');
            const paymentDetailsContent = document.getElementById('paymentDetailsContent');
            const nextStepsList = document.getElementById('nextStepsList');

            let title = '';
            let content = '';
            let additionalSteps = [];

            switch(order.paymentMethod) {
                case 'credit':
                    // ã‚¯ãƒ¬ã‚¸ãƒƒãƒˆã‚«ãƒ¼ãƒ‰æ±ºæ¸ˆã®å ´åˆ
                    title = 'ğŸ’³ ã‚¯ãƒ¬ã‚¸ãƒƒãƒˆã‚«ãƒ¼ãƒ‰æ±ºæ¸ˆã«ã¤ã„ã¦';
                    content = `
                        <p style="margin-bottom: 12px;"><strong>æ±ºæ¸ˆãŒå®Œäº†ã—ã¾ã—ãŸã€‚</strong></p>
                        <p>ã‚¯ãƒ¬ã‚¸ãƒƒãƒˆã‚«ãƒ¼ãƒ‰ã§ã®æ±ºæ¸ˆãŒæ­£å¸¸ã«å‡¦ç†ã•ã‚Œã¾ã—ãŸã€‚å•†å“ã®ç™ºé€æº–å‚™ã‚’é–‹å§‹ã„ãŸã—ã¾ã™ã€‚</p>
                    `;
                    additionalSteps = [];
                    break;

                case 'bank':
                    // éŠ€è¡ŒæŒ¯è¾¼ã®å ´åˆ
                    title = 'ğŸ¦ éŠ€è¡ŒæŒ¯è¾¼ã®ã”æ¡ˆå†…ï¼ˆé‡è¦ï¼‰';
                    content = `
                        <p style="margin-bottom: 12px;"><strong>ä»¥ä¸‹ã®å£åº§ã«ãŠæŒ¯è¾¼ã¿ãã ã•ã„</strong></p>
                        <div style="background: white; padding: 16px; border-radius: 8px; margin: 12px 0;">
                            <p style="margin: 4px 0;"><strong>éŠ€è¡Œåï¼š</strong>${order.bankInfo?.bankName || 'ã€‡ã€‡éŠ€è¡Œ'}</p>
                            <p style="margin: 4px 0;"><strong>æ”¯åº—åï¼š</strong>${order.bankInfo?.branchName || 'ã€‡ã€‡æ”¯åº—'}</p>
                            <p style="margin: 4px 0;"><strong>å£åº§ç¨®åˆ¥ï¼š</strong>${order.bankInfo?.accountType || 'æ™®é€š'}</p>
                            <p style="margin: 4px 0;"><strong>å£åº§ç•ªå·ï¼š</strong>${order.bankInfo?.accountNumber || '1234567'}</p>
                            <p style="margin: 4px 0;"><strong>å£åº§åç¾©ï¼š</strong>${order.bankInfo?.accountHolder || 'å®‰ç©ç›´å£²æ‰€'}</p>
                        </div>
                        <p style="color: #d9534f; font-weight: 600;">âš  7æ—¥ä»¥å†…ã«ãŠæŒ¯è¾¼ã¿ã‚’ãŠé¡˜ã„ã„ãŸã—ã¾ã™</p>
                        <p style="font-size: 13px; margin-top: 8px;">â€» ãŠæŒ¯è¾¼ã¿æ‰‹æ•°æ–™ã¯ãŠå®¢æ§˜è² æ‹…ã¨ãªã‚Šã¾ã™</p>
                    `;
                    additionalSteps = [
                        'ä¸Šè¨˜å£åº§ã¸7æ—¥ä»¥å†…ã«ãŠæŒ¯è¾¼ã¿ãã ã•ã„',
                        'ãŠæŒ¯è¾¼ã¿ç¢ºèªå¾Œã€3å–¶æ¥­æ—¥ä»¥å†…ã«å•†å“ã‚’ç™ºé€ã„ãŸã—ã¾ã™',
                        'æŒ¯è¾¼åç¾©ã¯ã”æ³¨æ–‡è€…æ§˜ã®ãŠåå‰ã¨ä¸€è‡´ã™ã‚‹ã‚ˆã†ãŠé¡˜ã„ã„ãŸã—ã¾ã™'
                    ];
                    break;

                case 'cod':
                    // ä»£é‡‘å¼•æ›ã®å ´åˆ
                    title = 'ğŸ’° ä»£é‡‘å¼•æ›ã§ã®ãŠæ”¯æ‰•ã„ã«ã¤ã„ã¦';
                    const codTotal = order.subtotal + order.shipping + order.codFee;
                    content = `
                        <p style="margin-bottom: 12px;"><strong>å•†å“å—å–æ™‚ã«é…é”å“¡ã¸ç¾é‡‘ã§ãŠæ”¯æ‰•ã„ãã ã•ã„</strong></p>
                        <div style="background: white; padding: 16px; border-radius: 8px; margin: 12px 0;">
                            <p style="margin: 4px 0;"><strong>ãŠæ”¯æ‰•ã„é‡‘é¡ï¼ˆä»£å¼•æ‰‹æ•°æ–™è¾¼ï¼‰ï¼š</strong><span style="font-size: 20px; color: #28a745;">Â¥${codTotal.toLocaleString()}</span></p>
                        </div>
                        <p style="font-size: 13px; margin-top: 8px;">â€» ãŠé‡£ã‚Šã®ãªã„ã‚ˆã†ã”æº–å‚™ã„ãŸã ã‘ã‚‹ã¨åŠ©ã‹ã‚Šã¾ã™</p>
                        <p style="font-size: 13px;">â€» é…é”æ™‚ã«ã”ä¸åœ¨ã®å ´åˆã¯å†é…é”ã¨ãªã‚Šã¾ã™ã®ã§ã”æ³¨æ„ãã ã•ã„</p>
                    `;
                    additionalSteps = [
                        'ãŠæ”¯æ‰•ã„é‡‘é¡ï¼ˆÂ¥' + codTotal.toLocaleString() + 'ï¼‰ã‚’ç¾é‡‘ã§ã”æº–å‚™ãã ã•ã„',
                        'å•†å“åˆ°ç€æ™‚ã«é…é”å“¡ã¸ãŠæ”¯æ‰•ã„ã‚’ãŠé¡˜ã„ã„ãŸã—ã¾ã™',
                        'é ˜åæ›¸ã¯é…é”å“¡ãŒãŠæ¸¡ã—ã„ãŸã—ã¾ã™'
                    ];
                    break;

                case 'konbini':
                    // ã‚³ãƒ³ãƒ“ãƒ‹æ±ºæ¸ˆã®å ´åˆ
                    title = 'ğŸª ã‚³ãƒ³ãƒ“ãƒ‹æ±ºæ¸ˆã®ã”æ¡ˆå†…ï¼ˆé‡è¦ï¼‰';
                    content = `
                        <p style="margin-bottom: 12px;"><strong>ãŠæ”¯æ‰•ã„ç•ªå·ã‚’ãƒ¡ãƒ¼ãƒ«ã§ãŠé€ã‚Šã—ã¾ã—ãŸ</strong></p>
                        <div style="background: white; padding: 16px; border-radius: 8px; margin: 12px 0;">
                            <p style="margin: 4px 0;"><strong>ãŠæ”¯æ‰•ã„ç•ªå·ï¼š</strong><span style="font-size: 18px; font-family: monospace; color: #007bff;">${order.paymentNumber || 'KB-XXXXXXXXXX'}</span></p>
                        </div>
                        <p style="margin-bottom: 8px;"><strong>ãŠæ”¯æ‰•ã„å¯èƒ½ãªã‚³ãƒ³ãƒ“ãƒ‹ï¼š</strong></p>
                        <ul style="padding-left: 20px; margin-bottom: 12px;">
                            <li>ã‚»ãƒ–ãƒ³ã‚¤ãƒ¬ãƒ–ãƒ³</li>
                            <li>ãƒ­ãƒ¼ã‚½ãƒ³</li>
                            <li>ãƒ•ã‚¡ãƒŸãƒªãƒ¼ãƒãƒ¼ãƒˆ</li>
                        </ul>
                        <p style="color: #d9534f; font-weight: 600;">âš  7æ—¥ä»¥å†…ã«ãŠæ”¯æ‰•ã„ã‚’ãŠé¡˜ã„ã„ãŸã—ã¾ã™</p>
                        <p style="font-size: 13px; margin-top: 8px;">â€» ã‚³ãƒ³ãƒ“ãƒ‹åº—é ­ã®ç«¯æœ«ã§ãŠæ”¯æ‰•ã„ç•ªå·ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„</p>
                    `;
                    additionalSteps = [
                        'ãƒ¡ãƒ¼ãƒ«ã«è¨˜è¼‰ã®ãŠæ”¯æ‰•ã„ç•ªå·ã‚’ç¢ºèªã—ã¦ãã ã•ã„',
                        '7æ—¥ä»¥å†…ã«ã‚³ãƒ³ãƒ“ãƒ‹ã§ãŠæ”¯æ‰•ã„ãã ã•ã„',
                        'ãŠæ”¯æ‰•ã„ç¢ºèªå¾Œã€3å–¶æ¥­æ—¥ä»¥å†…ã«å•†å“ã‚’ç™ºé€ã„ãŸã—ã¾ã™'
                    ];
                    break;
            }

            if (title && content) {
                paymentDetailsDiv.style.display = 'block';
                paymentDetailsTitle.innerHTML = title;
                paymentDetailsContent.innerHTML = content;

                // è¿½åŠ ã®ã‚¹ãƒ†ãƒƒãƒ—ãŒã‚ã‚Œã°è¡¨ç¤º
                if (additionalSteps.length > 0) {
                    additionalSteps.forEach(step => {
                        const li = document.createElement('li');
                        li.textContent = step;
                        nextStepsList.appendChild(li);
                    });
                }
            }
        }

        // æ³¨æ–‡æƒ…å ±ã‚’è¡¨ç¤º
        function displayOrderInfo() {
            // æ³¨æ–‡ç•ªå·ã‚’ç”Ÿæˆï¼ˆå®Ÿéš›ã«ã¯ã‚µãƒ¼ãƒãƒ¼ã‹ã‚‰å–å¾—ï¼‰
            const orderNumber = 'AZK' + Date.now().toString().slice(-8);
            document.getElementById('orderNumber').textContent = orderNumber;

            // æ³¨æ–‡æ—¥æ™‚
            const now = new Date();
            const dateStr = now.getFullYear() + 'å¹´' + 
                           (now.getMonth() + 1) + 'æœˆ' + 
                           now.getDate() + 'æ—¥ ' + 
                           now.getHours().toString().padStart(2, '0') + ':' + 
                           now.getMinutes().toString().padStart(2, '0');
            document.getElementById('orderDate').textContent = dateStr;

            // localStorageã‹ã‚‰æ³¨æ–‡ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—
            try {
                const orderData = localStorage.getItem('lastOrder');
                if (orderData) {
                    const order = JSON.parse(orderData);
                    
                    // æ”¯æ‰•ã„æ–¹æ³•
                    const paymentMethods = {
                        'credit': 'ã‚¯ãƒ¬ã‚¸ãƒƒãƒˆã‚«ãƒ¼ãƒ‰',
                        'bank': 'éŠ€è¡ŒæŒ¯è¾¼',
                        'cod': 'ä»£é‡‘å¼•æ›',
                        'konbini': 'ã‚³ãƒ³ãƒ“ãƒ‹æ±ºæ¸ˆ'
                    };
                    document.getElementById('paymentMethod').textContent = 
                        paymentMethods[order.paymentMethod] || order.paymentMethod;

                    // é…é€å…ˆ
                    if (order.shipping) {
                        const addr = `${order.shipping.prefecture} ${order.shipping.city} ${order.shipping.address}`;
                        document.getElementById('shippingAddress').textContent = addr;
                    }

                    // åˆè¨ˆé‡‘é¡
                    const total = order.subtotal + order.shipping + (order.codFee || 0);
                    document.getElementById('totalAmount').textContent = `Â¥${total.toLocaleString()}`;

                    // æ”¯æ‰•ã„æ–¹æ³•åˆ¥ã®è©³ç´°æƒ…å ±ã‚’è¡¨ç¤º
                    showPaymentSpecificInfo(order);

                    // æ³¨æ–‡ãƒ‡ãƒ¼ã‚¿ã‚’ã‚¯ãƒªã‚¢
                    localStorage.removeItem('lastOrder');
                    // ã‚«ãƒ¼ãƒˆã¯æ—¢ã«checkout.htmlã§ã‚¯ãƒªã‚¢æ¸ˆã¿
                    
                    // ã‚«ãƒ¼ãƒˆãŒã‚¯ãƒªã‚¢ã•ã‚Œã¦ã„ã‚‹ã“ã¨ã‚’ç¢ºèª
                    const cartCheck = localStorage.getItem('cartItems');
                    if (cartCheck) {
                        console.warn('ã‚«ãƒ¼ãƒˆãŒã¾ã æ®‹ã£ã¦ã„ã¾ã™ã€‚ã‚¯ãƒªã‚¢ã—ã¾ã™ã€‚');
                        localStorage.removeItem('cartItems');
                    }
                    console.log('âœ“ æ³¨æ–‡ãŒå®Œäº†ã—ã€ã‚«ãƒ¼ãƒˆãŒã‚¯ãƒªã‚¢ã•ã‚Œã¾ã—ãŸ');
                }
            } catch (e) {
                console.error('æ³¨æ–‡ãƒ‡ãƒ¼ã‚¿ã®èª­ã¿è¾¼ã¿ã‚¨ãƒ©ãƒ¼:', e);
            }
        }

        // ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿æ™‚ã«å®Ÿè¡Œ
        displayOrderInfo();
    </script>
</body>
</html>
