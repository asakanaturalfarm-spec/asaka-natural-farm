<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç®¡ç†è€…é€šçŸ¥ | å®‰ç©ç›´å£²æ‰€</title>
    <link rel="stylesheet" href="style.css?v=3">
    <style>
        body {
            font-family: 'Noto Sans JP', sans-serif;
            background: #f5f5f5;
            padding: 40px 20px;
        }

        .admin-container {
            max-width: 900px;
            margin: 0 auto;
        }

        .admin-header {
            background: white;
            padding: 24px 32px;
            border-radius: 12px;
            margin-bottom: 24px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .admin-header h1 {
            margin: 0 0 8px 0;
            font-size: 28px;
            color: #333;
        }

        .admin-header p {
            margin: 0;
            color: #666;
            font-size: 14px;
        }

        .notification-card {
            background: white;
            padding: 24px;
            border-radius: 12px;
            margin-bottom: 16px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            border-left: 4px solid #2d5016;
        }

        .notification-card.unread {
            background: #f0f7f0;
            border-left-color: #4CAF50;
        }

        .notification-header {
            display: flex;
            justify-content: space-between;
            align-items: start;
            margin-bottom: 12px;
        }

        .notification-subject {
            font-size: 18px;
            font-weight: 600;
            color: #333;
        }

        .notification-time {
            font-size: 13px;
            color: #999;
        }

        .notification-message {
            color: #666;
            line-height: 1.8;
            white-space: pre-wrap;
        }

        .notification-badge {
            display: inline-block;
            padding: 4px 12px;
            background: #4CAF50;
            color: white;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 600;
            margin-left: 12px;
        }

        .empty-state {
            text-align: center;
            padding: 60px 20px;
            background: white;
            border-radius: 12px;
            color: #999;
        }

        .empty-state-icon {
            font-size: 64px;
            margin-bottom: 16px;
        }

        .btn-clear {
            padding: 10px 20px;
            background: #dc3545;
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            margin-top: 16px;
        }

        .btn-clear:hover {
            background: #c82333;
        }

        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 16px;
            margin-bottom: 24px;
        }

        .stat-card {
            background: white;
            padding: 20px;
            border-radius: 12px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .stat-value {
            font-size: 32px;
            font-weight: 700;
            color: #2d5016;
            margin-bottom: 4px;
        }

        .stat-label {
            font-size: 13px;
            color: #666;
        }
    </style>
</head>
<body>
    <div class="admin-container">
        <div class="admin-header">
            <h1>ğŸ”” ç®¡ç†è€…é€šçŸ¥
                <span class="notification-badge" id="unreadBadge" style="display: none;">0</span>
            </h1>
            <p>ãƒ¦ãƒ¼ã‚¶ãƒ¼ç™»éŒ²ãƒ»èªè¨¼ã®é€šçŸ¥ã‚’ç¢ºèªã§ãã¾ã™ï¼ˆé–‹ç™ºç”¨ï¼‰</p>
        </div>

        <div class="stats">
            <div class="stat-card">
                <div class="stat-value" id="totalNotifications">0</div>
                <div class="stat-label">ç·é€šçŸ¥æ•°</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="unreadNotifications">0</div>
                <div class="stat-label">æœªèª­é€šçŸ¥</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="totalUsers">0</div>
                <div class="stat-label">ç™»éŒ²ãƒ¦ãƒ¼ã‚¶ãƒ¼æ•°</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="verifiedUsers">0</div>
                <div class="stat-label">èªè¨¼æ¸ˆã¿ãƒ¦ãƒ¼ã‚¶ãƒ¼</div>
            </div>
        </div>

        <div id="notificationsContainer">
            <!-- JavaScriptã§å‹•çš„ã«ç”Ÿæˆ -->
        </div>

        <div style="text-align: center; margin-top: 24px;">
            <button onclick="clearAllNotifications()" class="btn-clear">ã™ã¹ã¦ã®é€šçŸ¥ã‚’å‰Šé™¤</button>
            <a href="index.html" style="display: inline-block; margin-left: 16px; padding: 10px 20px; color: #666; text-decoration: none;">â† ãƒ›ãƒ¼ãƒ ã«æˆ»ã‚‹</a>
        </div>
    </div>

    <script>
        /**
         * ========================================
         * ãƒ‡ãƒ¼ã‚¿ã‚¢ã‚¯ã‚»ã‚¹å±¤ï¼ˆData Access Layerï¼‰
         * ========================================
         * LocalStorageã¨ã®é€šä¿¡ã‚’ä¸€å…ƒç®¡ç†ã™ã‚‹ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«
         * ãƒ‡ãƒ¼ã‚¿ã®å–å¾—ãƒ»ä¿å­˜ãƒ»å‰Šé™¤å‡¦ç†ã‚’æŠ½è±¡åŒ–ã—ã€ä»–ã®ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã‹ã‚‰ç›´æ¥LocalStorageã‚’æ“ä½œã—ãªã„è¨­è¨ˆ
         */
        const DataStore = {
            /**
             * ç®¡ç†è€…é€šçŸ¥ä¸€è¦§ã‚’å–å¾—
             * @returns {Array<Object>} é€šçŸ¥ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®é…åˆ—
             */
            getNotifications: () => JSON.parse(localStorage.getItem('adminNotifications') ?? '[]'),

            /**
             * ç®¡ç†è€…é€šçŸ¥ä¸€è¦§ã‚’ä¿å­˜
             * @param {Array<Object>} notifications - ä¿å­˜ã™ã‚‹é€šçŸ¥ã®é…åˆ—
             */
            saveNotifications: notifications => 
                localStorage.setItem('adminNotifications', JSON.stringify(notifications)),

            /**
             * å…¨ãƒ¦ãƒ¼ã‚¶ãƒ¼æƒ…å ±ã‚’å–å¾—
             * @returns {Array<Object>} ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®é…åˆ—
             */
            getUsers: () => JSON.parse(localStorage.getItem('users') ?? '[]'),

            /**
             * ã™ã¹ã¦ã®é€šçŸ¥ã‚’å‰Šé™¤ï¼ˆç©ºé…åˆ—ã§ä¸Šæ›¸ãï¼‰
             */
            clearNotifications: () => localStorage.setItem('adminNotifications', '[]')
        };


        /**
         * ========================================
         * çµ±è¨ˆè¨ˆç®—ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ï¼ˆStatistics Calculatorï¼‰
         * ========================================
         * é€šçŸ¥ã¨ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®çµ±è¨ˆæƒ…å ±ã‚’ç®—å‡ºã™ã‚‹ç´”ç²‹é–¢æ•°ç¾¤
         * å‰¯ä½œç”¨ãªã—ã§è¨ˆç®—çµæœã®ã¿ã‚’è¿”ã™ãŸã‚ã€ãƒ†ã‚¹ãƒˆãŒå®¹æ˜“
         */
        const StatsCalculator = {
            /**
             * é€šçŸ¥ã®çµ±è¨ˆæƒ…å ±ã‚’è¨ˆç®—
             * @param {Array<Object>} notifications - é€šçŸ¥ä¸€è¦§
             * @returns {Object} { total: ç·æ•°, unread: æœªèª­æ•° }
             */
            calculateNotificationStats: notifications => ({
                total: notifications.length,
                unread: notifications.filter(notification => !notification.read).length
            }),

            /**
             * ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®çµ±è¨ˆæƒ…å ±ã‚’è¨ˆç®—
             * @param {Array<Object>} users - ãƒ¦ãƒ¼ã‚¶ãƒ¼ä¸€è¦§
             * @returns {Object} { total: ç·æ•°, verified: èªè¨¼æ¸ˆã¿ãƒ¦ãƒ¼ã‚¶ãƒ¼æ•° }
             */
            calculateUserStats: users => ({
                total: users.length,
                verified: users.filter(user => user.verified).length
            })
        };


        /**
         * ========================================
         * UIæç”»ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ï¼ˆUI Rendererï¼‰
         * ========================================
         * ç”»é¢ã¸ã®æç”»ãƒ­ã‚¸ãƒƒã‚¯ã‚’é›†ç´„ã—ãŸãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«
         * ãƒ‡ãƒ¼ã‚¿ã‚’å—ã‘å–ã‚Šã€HTMLã‚’ç”Ÿæˆãƒ»æ›´æ–°ã™ã‚‹è²¬å‹™ã®ã¿ã‚’æŒã¤
         */
        const UIRenderer = {
            /**
             * æœªèª­ãƒãƒƒã‚¸ã®è¡¨ç¤ºã‚’æ›´æ–°
             * @param {number} unreadCount - æœªèª­é€šçŸ¥ã®ä»¶æ•°
             */
            renderUnreadBadge: unreadCount => {
                const badgeElement = document.getElementById('unreadBadge');
                Object.assign(badgeElement, {
                    textContent: unreadCount,
                    style: { display: unreadCount > 0 ? 'inline-block' : 'none' }
                });
            },

            /**
             * é€šçŸ¥ãŒ0ä»¶ã®å ´åˆã®ç©ºçŠ¶æ…‹UIã‚’è¡¨ç¤º
             * @param {HTMLElement} containerElement - é€šçŸ¥ã‚’è¡¨ç¤ºã™ã‚‹ã‚³ãƒ³ãƒ†ãƒŠè¦ç´ 
             */
            renderEmptyState: containerElement => containerElement.innerHTML = `
                <div class="empty-state">
                    <div class="empty-state-icon">ğŸ“­</div>
                    <p>é€šçŸ¥ã¯ã‚ã‚Šã¾ã›ã‚“</p>
                </div>`,

            /**
             * ã‚¿ã‚¤ãƒ ã‚¹ã‚¿ãƒ³ãƒ—ã‚’æ—¥æœ¬èªã®æ—¥æ™‚æ–‡å­—åˆ—ã«ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆ
             * @param {number} timestamp - Unixã‚¿ã‚¤ãƒ ã‚¹ã‚¿ãƒ³ãƒ—ï¼ˆãƒŸãƒªç§’ï¼‰
             * @returns {string} æ—¥æœ¬èªå½¢å¼ã®æ—¥æ™‚æ–‡å­—åˆ—ï¼ˆä¾‹: 2026/1/17 10:30:45ï¼‰
             */
            formatTimestamp: timestamp => new Date(timestamp).toLocaleString('ja-JP'),

            /**
             * é€šçŸ¥ã‚«ãƒ¼ãƒ‰ã®HTMLæ–‡å­—åˆ—ã‚’ç”Ÿæˆ
             * @param {Object} notification - é€šçŸ¥ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ
             * @param {number} notification.timestamp - é€šçŸ¥æ—¥æ™‚
             * @param {boolean} notification.read - æ—¢èª­ãƒ•ãƒ©ã‚°
             * @param {string} notification.subject - ä»¶å
             * @param {string} notification.message - æœ¬æ–‡
             * @returns {string} é€šçŸ¥ã‚«ãƒ¼ãƒ‰ã®HTMLæ–‡å­—åˆ—
             */
            createNotificationHTML: ({ timestamp, read, subject, message }) => `
                <div class="notification-card ${read ? '' : 'unread'}">
                    <div class="notification-header">
                        <div class="notification-subject">${subject}</div>
                        <div class="notification-time">${UIRenderer.formatTimestamp(timestamp)}</div>
                    </div>
                    <div class="notification-message">${message}</div>
                </div>`,

            /**
             * é€šçŸ¥ä¸€è¦§ã‚’ç”»é¢ã«æç”»
             * @param {Array<Object>} notifications - é€šçŸ¥ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®é…åˆ—
             * @param {HTMLElement} containerElement - æç”»å…ˆã®ã‚³ãƒ³ãƒ†ãƒŠè¦ç´ 
             */
            renderNotifications: (notifications, containerElement) => 
                notifications.length === 0 
                    ? UIRenderer.renderEmptyState(containerElement)
                    : containerElement.innerHTML = notifications
                        .map(UIRenderer.createNotificationHTML)
                        .join(''),

            /**
             * çµ±è¨ˆæƒ…å ±ã‚’ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã®ã‚«ãƒ¼ãƒ‰ã«è¡¨ç¤º
             * @param {Object} stats - çµ±è¨ˆãƒ‡ãƒ¼ã‚¿
             * @param {Object} stats.notifications - é€šçŸ¥ã®çµ±è¨ˆ
             * @param {Object} stats.users - ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®çµ±è¨ˆ
             */
            renderStats: ({ notifications, users }) => 
                Object.entries({
                    totalNotifications: notifications.total,
                    unreadNotifications: notifications.unread,
                    totalUsers: users.total,
                    verifiedUsers: users.verified
                }).forEach(([elementId, value]) => 
                    document.getElementById(elementId).textContent = value
                )
        };


        /**
         * ========================================
         * é€šçŸ¥ç®¡ç†ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ï¼ˆNotification Managerï¼‰
         * ========================================
         * é€šçŸ¥ã«é–¢ã™ã‚‹ãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯ã‚’æ‹…å½“
         * èª­ã¿è¾¼ã¿ã€æ—¢èª­å‡¦ç†ã€å‰Šé™¤ãªã©ã®æ“ä½œã‚’ç®¡ç†
         */
        const NotificationManager = {
            /**
             * ã™ã¹ã¦ã®é€šçŸ¥ã‚’æ—¢èª­ã«ãƒãƒ¼ã‚¯
             * @param {Array<Object>} notifications - é€šçŸ¥ã®é…åˆ—
             * @returns {Array<Object>} æ—¢èª­ãƒ•ãƒ©ã‚°ã‚’trueã«ã—ãŸæ–°ã—ã„é…åˆ—ï¼ˆã‚¤ãƒŸãƒ¥ãƒ¼ã‚¿ãƒ–ãƒ«ï¼‰
             */
            markAllAsRead: notifications => 
                notifications.map(notification => ({ ...notification, read: true })),

            /**
             * é€šçŸ¥ã‚’èª­ã¿è¾¼ã¿ã€ç”»é¢ã«è¡¨ç¤ºã—ã€æ—¢èª­å‡¦ç†ã‚’å®Ÿè¡Œ
             * ã“ã®ãƒ¡ã‚½ãƒƒãƒ‰ãŒå‘¼ã°ã‚Œã‚‹ã¨è‡ªå‹•çš„ã«å…¨é€šçŸ¥ãŒæ—¢èª­ã«ãªã‚‹
             */
            load: () => {
                const notifications = DataStore.getNotifications();
                const containerElement = document.getElementById('notificationsContainer');
                const { unread } = StatsCalculator.calculateNotificationStats(notifications);
                
                UIRenderer.renderUnreadBadge(unread);
                UIRenderer.renderNotifications(notifications, containerElement);
                DataStore.saveNotifications(NotificationManager.markAllAsRead(notifications));
            },

            /**
             * ã™ã¹ã¦ã®é€šçŸ¥ã‚’å‰Šé™¤
             * ãƒ¦ãƒ¼ã‚¶ãƒ¼ã«ç¢ºèªãƒ€ã‚¤ã‚¢ãƒ­ã‚°ã‚’è¡¨ç¤ºã—ã€OKã®å ´åˆã®ã¿å®Ÿè¡Œ
             */
            clearAll: () => confirm('ã™ã¹ã¦ã®é€šçŸ¥ã‚’å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ') && (
                DataStore.clearNotifications(),
                AppController.refresh()
            )
        };


        /**
         * ========================================
         * ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ãƒ¼ï¼ˆApplication Controllerï¼‰
         * ========================================
         * ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³å…¨ä½“ã®å‡¦ç†ãƒ•ãƒ­ãƒ¼ã‚’åˆ¶å¾¡
         * å„ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ã‚’çµ±åˆã—ã€åˆæœŸåŒ–ã‚„ãƒªãƒ•ãƒ¬ãƒƒã‚·ãƒ¥ãªã©ã®é«˜ãƒ¬ãƒ™ãƒ«æ“ä½œã‚’æä¾›
         */
        const AppController = {
            /**
             * çµ±è¨ˆæƒ…å ±ã‚’èª­ã¿è¾¼ã‚“ã§ç”»é¢ã«è¡¨ç¤º
             * é€šçŸ¥ã¨ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ä¸¡æ–¹ã®çµ±è¨ˆã‚’è¨ˆç®—ã—ã€ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã‚«ãƒ¼ãƒ‰ã«åæ˜ 
             */
            loadStats: () => UIRenderer.renderStats({
                notifications: StatsCalculator.calculateNotificationStats(DataStore.getNotifications()),
                users: StatsCalculator.calculateUserStats(DataStore.getUsers())
            }),

            /**
             * é€šçŸ¥ã¨çµ±è¨ˆã‚’å†èª­ã¿è¾¼ã¿ï¼ˆç”»é¢å…¨ä½“ã‚’ãƒªãƒ•ãƒ¬ãƒƒã‚·ãƒ¥ï¼‰
             */
            refresh: () => (NotificationManager.load(), AppController.loadStats()),

            /**
             * ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã®åˆæœŸåŒ–
             * ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿æ™‚ã«ä¸€åº¦ã ã‘å®Ÿè¡Œã•ã‚Œã‚‹
             */
            init: () => AppController.refresh()
        };


        /**
         * ========================================
         * ã‚°ãƒ­ãƒ¼ãƒãƒ«å…¬é–‹é–¢æ•°
         * ========================================
         * HTMLã®onclickå±æ€§ã‹ã‚‰å‘¼ã³å‡ºã™ãŸã‚ã®ã‚°ãƒ­ãƒ¼ãƒãƒ«ã‚¹ã‚³ãƒ¼ãƒ—ã®é–¢æ•°
         */
        
        /**
         * ã™ã¹ã¦ã®é€šçŸ¥ã‚’å‰Šé™¤ï¼ˆHTMLã‹ã‚‰å‘¼ã³å‡ºã—ç”¨ï¼‰
         */
        const clearAllNotifications = () => NotificationManager.clearAll();


        /**
         * ========================================
         * ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³èµ·å‹•
         * ========================================
         */
        window.addEventListener('DOMContentLoaded', AppController.init);
    </script>
</body>
</html>
