<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å…¨ãƒ‡ãƒ¼ã‚¿ãƒªã‚»ãƒƒãƒˆ | å®‰ç©ç›´å£²æ‰€</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .container {
            background: white;
            border-radius: 20px;
            padding: 60px 40px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            max-width: 600px;
            width: 100%;
            text-align: center;
        }

        h1 {
            font-size: 32px;
            color: #2d3748;
            margin-bottom: 20px;
        }

        .warning {
            background: #fff5f5;
            border: 2px solid #fc8181;
            border-radius: 12px;
            padding: 20px;
            margin: 30px 0;
            color: #742a2a;
        }

        .warning h2 {
            font-size: 20px;
            margin-bottom: 10px;
            color: #c53030;
        }

        .data-list {
            text-align: left;
            margin: 20px 0;
            padding: 20px;
            background: #f7fafc;
            border-radius: 8px;
        }

        .data-list h3 {
            font-size: 18px;
            margin-bottom: 15px;
            color: #2d3748;
        }

        .data-list ul {
            list-style: none;
        }

        .data-list li {
            padding: 8px 0;
            border-bottom: 1px solid #e2e8f0;
            font-size: 14px;
            color: #4a5568;
        }

        .data-list li:last-child {
            border-bottom: none;
        }

        .data-list li::before {
            content: "âœ“ ";
            color: #48bb78;
            font-weight: bold;
            margin-right: 8px;
        }

        .buttons {
            display: flex;
            gap: 15px;
            margin-top: 30px;
        }

        button {
            flex: 1;
            padding: 16px 24px;
            border: none;
            border-radius: 12px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s;
        }

        .btn-reset {
            background: #e53e3e;
            color: white;
        }

        .btn-reset:hover {
            background: #c53030;
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(229, 62, 62, 0.3);
        }

        .btn-cancel {
            background: #e2e8f0;
            color: #2d3748;
        }

        .btn-cancel:hover {
            background: #cbd5e0;
        }

        .status {
            margin-top: 30px;
            padding: 20px;
            border-radius: 12px;
            font-size: 16px;
            display: none;
        }

        .status.success {
            background: #c6f6d5;
            color: #22543d;
            border: 2px solid #48bb78;
            display: block;
        }

        .status.error {
            background: #fed7d7;
            color: #742a2a;
            border: 2px solid #fc8181;
            display: block;
        }

        .log {
            margin-top: 20px;
            padding: 15px;
            background: #2d3748;
            color: #e2e8f0;
            border-radius: 8px;
            text-align: left;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            max-height: 200px;
            overflow-y: auto;
            display: none;
        }

        .log.active {
            display: block;
        }

        .log-line {
            margin: 5px 0;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ”„ å…¨ãƒ‡ãƒ¼ã‚¿ãƒªã‚»ãƒƒãƒˆ</h1>
        <p style="color: #718096; margin-bottom: 20px;">ã™ã¹ã¦ã®ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ãƒ‡ãƒ¼ã‚¿ã‚’åˆæœŸåŒ–ã—ã¾ã™</p>

        <div class="warning">
            <h2>âš ï¸ é‡è¦ãªè­¦å‘Š</h2>
            <p>ä»¥ä¸‹ã®ãƒ‡ãƒ¼ã‚¿ãŒå®Œå…¨ã«å‰Šé™¤ã•ã‚Œã¾ã™ã€‚ã“ã®æ“ä½œã¯å–ã‚Šæ¶ˆã›ã¾ã›ã‚“ã€‚</p>
        </div>

        <div class="data-list">
            <h3>å‰Šé™¤ã•ã‚Œã‚‹ãƒ‡ãƒ¼ã‚¿:</h3>
            <ul>
                <li>åœ¨åº«ãƒ‡ãƒ¼ã‚¿ï¼ˆå…¨å•†å“ã®åœ¨åº«æƒ…å ±ï¼‰</li>
                <li>æ³¨æ–‡ãƒ‡ãƒ¼ã‚¿ï¼ˆå—æ³¨ç®¡ç†ã‚¢ãƒ—ãƒªã®å…¨æ³¨æ–‡ï¼‰</li>
                <li><img src="../cart-icon.svg" alt="ã‚«ãƒ¼ãƒˆ" style="height:1em;width:auto;vertical-align:middle;"> ã‚«ãƒ¼ãƒˆãƒ‡ãƒ¼ã‚¿ï¼ˆECã‚µã‚¤ãƒˆã®ã‚«ãƒ¼ãƒˆå†…å®¹ï¼‰</li>
                <li>ãŠæ°—ã«å…¥ã‚Šå•†å“</li>
                <li>å¸³ç°¿ãƒ‡ãƒ¼ã‚¿ï¼ˆåæ”¯è¨˜éŒ²ï¼‰</li>
                <li>åç©«é‡ãƒ»å‡ºè·å¯èƒ½é‡ãƒ‡ãƒ¼ã‚¿</li>
                <li>ãã®ä»–ã™ã¹ã¦ã®LocalStorageãƒ‡ãƒ¼ã‚¿</li>
            </ul>
        </div>

        <div class="buttons">
            <button class="btn-cancel" onclick="window.close()">ã‚­ãƒ£ãƒ³ã‚»ãƒ«</button>
            <button class="btn-reset" onclick="resetAllData()">ã™ã¹ã¦ãƒªã‚»ãƒƒãƒˆã™ã‚‹</button>
        </div>

        <div class="status" id="status"></div>
        <div class="log" id="log"></div>
    </div>

    <script src="inventory-sync.js"></script>
    <script>
        function addLog(message, type = 'info') {
            const logDiv = document.getElementById('log');
            logDiv.classList.add('active');
            const line = document.createElement('div');
            line.className = 'log-line';
            const timestamp = new Date().toLocaleTimeString('ja-JP');
            const icon = type === 'success' ? 'âœ“' : type === 'error' ? 'âœ—' : 'â†’';
            line.textContent = `[${timestamp}] ${icon} ${message}`;
            logDiv.appendChild(line);
            logDiv.scrollTop = logDiv.scrollHeight;
        }

        function resetAllData() {
            if (!confirm('æœ¬å½“ã«ã™ã¹ã¦ã®ãƒ‡ãƒ¼ã‚¿ã‚’ãƒªã‚»ãƒƒãƒˆã—ã¾ã™ã‹ï¼Ÿ\nã“ã®æ“ä½œã¯å–ã‚Šæ¶ˆã›ã¾ã›ã‚“ã€‚')) {
                return;
            }

            const statusDiv = document.getElementById('status');
            const logDiv = document.getElementById('log');
            logDiv.innerHTML = '';
            logDiv.classList.add('active');

            addLog('ãƒ‡ãƒ¼ã‚¿ãƒªã‚»ãƒƒãƒˆé–‹å§‹...');

            try {
                // 1. åœ¨åº«ãƒ‡ãƒ¼ã‚¿ã‚’ãƒªã‚»ãƒƒãƒˆï¼ˆå…¨å•†å“10å€‹ã«åˆæœŸåŒ–ï¼‰
                addLog('åœ¨åº«ãƒ‡ãƒ¼ã‚¿ã‚’åˆæœŸåŒ–ä¸­...');
                if (window.InventorySync) {
                    window.InventorySync.reset(10);
                    addLog('åœ¨åº«ãƒ‡ãƒ¼ã‚¿ã‚’å…¨å•†å“10å€‹ã«åˆæœŸåŒ–ã—ã¾ã—ãŸ', 'success');
                } else {
                    localStorage.removeItem('inventory_realtime');
                    localStorage.removeItem('inventory_log');
                    addLog('åœ¨åº«ãƒ‡ãƒ¼ã‚¿ã‚’å‰Šé™¤ã—ã¾ã—ãŸ', 'success');
                }

                // 2. æ³¨æ–‡ãƒ‡ãƒ¼ã‚¿ã‚’ã‚¯ãƒªã‚¢
                addLog('æ³¨æ–‡ãƒ‡ãƒ¼ã‚¿ã‚’ã‚¯ãƒªã‚¢ä¸­...');
                const orderKeys = [
                    'orders',
                    'orderManagement_orders',
                    'lastOrder',
                    'orderHistory'
                ];
                orderKeys.forEach(key => {
                    localStorage.removeItem(key);
                });
                addLog('æ³¨æ–‡ãƒ‡ãƒ¼ã‚¿ã‚’ã‚¯ãƒªã‚¢ã—ã¾ã—ãŸ', 'success');

                // 3. ã‚«ãƒ¼ãƒˆãƒ‡ãƒ¼ã‚¿ã‚’ã‚¯ãƒªã‚¢
                addLog('ã‚«ãƒ¼ãƒˆãƒ‡ãƒ¼ã‚¿ã‚’ã‚¯ãƒªã‚¢ä¸­...');
                localStorage.removeItem('cartItems');
                addLog('ã‚«ãƒ¼ãƒˆãƒ‡ãƒ¼ã‚¿ã‚’ã‚¯ãƒªã‚¢ã—ã¾ã—ãŸ', 'success');

                // 4. ãŠæ°—ã«å…¥ã‚Šã‚’ã‚¯ãƒªã‚¢
                addLog('ãŠæ°—ã«å…¥ã‚Šãƒ‡ãƒ¼ã‚¿ã‚’ã‚¯ãƒªã‚¢ä¸­...');
                localStorage.removeItem('favorites');
                addLog('ãŠæ°—ã«å…¥ã‚Šãƒ‡ãƒ¼ã‚¿ã‚’ã‚¯ãƒªã‚¢ã—ã¾ã—ãŸ', 'success');

                // 5. å¸³ç°¿ãƒ‡ãƒ¼ã‚¿ã‚’ã‚¯ãƒªã‚¢
                addLog('å¸³ç°¿ãƒ‡ãƒ¼ã‚¿ã‚’ã‚¯ãƒªã‚¢ä¸­...');
                const accountingKeys = [
                    'transactions',
                    'accounts',
                    'budgets',
                    'categories'
                ];
                accountingKeys.forEach(key => {
                    localStorage.removeItem(key);
                });
                addLog('å¸³ç°¿ãƒ‡ãƒ¼ã‚¿ã‚’ã‚¯ãƒªã‚¢ã—ã¾ã—ãŸ', 'success');

                // 6. åç©«é‡ãƒ‡ãƒ¼ã‚¿ã‚’ã‚¯ãƒªã‚¢
                addLog('åç©«é‡ãƒ‡ãƒ¼ã‚¿ã‚’ã‚¯ãƒªã‚¢ä¸­...');
                const harvestKeys = [
                    'harvests',
                    'harvestPlans',
                    'shippableQuantity'
                ];
                harvestKeys.forEach(key => {
                    localStorage.removeItem(key);
                });
                addLog('åç©«é‡ãƒ‡ãƒ¼ã‚¿ã‚’ã‚¯ãƒªã‚¢ã—ã¾ã—ãŸ', 'success');

                // 7. ãã®ä»–ã®ãƒ‡ãƒ¼ã‚¿ã‚’ã‚¯ãƒªã‚¢
                addLog('ãã®ä»–ã®ãƒ‡ãƒ¼ã‚¿ã‚’ã‚¯ãƒªã‚¢ä¸­...');
                const otherKeys = [
                    'customers',
                    'products',
                    'suppliers',
                    'notifications',
                    'userSettings'
                ];
                otherKeys.forEach(key => {
                    localStorage.removeItem(key);
                });
                addLog('ãã®ä»–ã®ãƒ‡ãƒ¼ã‚¿ã‚’ã‚¯ãƒªã‚¢ã—ã¾ã—ãŸ', 'success');

                // å®Œäº†ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸
                addLog('========================================');
                addLog('ã™ã¹ã¦ã®ãƒ‡ãƒ¼ã‚¿ãƒªã‚»ãƒƒãƒˆãŒå®Œäº†ã—ã¾ã—ãŸï¼', 'success');
                addLog('========================================');

                statusDiv.className = 'status success';
                statusDiv.innerHTML = `
                    <strong>âœ“ ãƒªã‚»ãƒƒãƒˆå®Œäº†</strong><br>
                    ã™ã¹ã¦ã®ãƒ‡ãƒ¼ã‚¿ãŒåˆæœŸåŒ–ã•ã‚Œã¾ã—ãŸã€‚<br>
                    åœ¨åº«ã¯å„å•†å“10å€‹ã«è¨­å®šã•ã‚Œã¦ã„ã¾ã™ã€‚
                `;

                // 3ç§’å¾Œã«ãƒªãƒ­ãƒ¼ãƒ‰
                setTimeout(() => {
                    if (confirm('ãƒšãƒ¼ã‚¸ã‚’ãƒªãƒ­ãƒ¼ãƒ‰ã—ã¾ã™ã‹ï¼Ÿ')) {
                        window.location.href = 'index.html';
                    }
                }, 3000);

            } catch (error) {
                addLog(`ã‚¨ãƒ©ãƒ¼: ${error.message}`, 'error');
                statusDiv.className = 'status error';
                statusDiv.innerHTML = `
                    <strong>âœ— ãƒªã‚»ãƒƒãƒˆå¤±æ•—</strong><br>
                    ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ: ${error.message}
                `;
            }
        }

        // ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿æ™‚ã«ç¾åœ¨ã®ãƒ‡ãƒ¼ã‚¿é‡ã‚’è¡¨ç¤º
        window.addEventListener('DOMContentLoaded', function() {
            const itemCount = localStorage.length;
            const dataSize = new Blob(Object.values(localStorage)).size;
            console.log(`LocalStorageé …ç›®æ•°: ${itemCount}`);
            console.log(`ãƒ‡ãƒ¼ã‚¿ã‚µã‚¤ã‚º: ${(dataSize / 1024).toFixed(2)} KB`);
        });
    </script>
</body>
</html>
