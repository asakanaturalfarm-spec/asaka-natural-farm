<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="å•†å“è©³ç´° | å®‰ç©ç›´å£²æ‰€">
    <title>å•†å“è©³ç´° | å®‰ç©ç›´å£²æ‰€</title>
    <link rel="stylesheet" href="style.css?v=3">
    <link href="https://fonts.googleapis.com/css2?family=Noto+Serif+JP:wght@500;700&family=Noto+Sans+JP:wght@300;400;500&display=swap" rel="stylesheet">
    <style>
        .product-page {
            min-height: 100vh;
            background: var(--bg-cream);
            padding: 120px 40px;
        }

        .product-container {
            max-width: 1200px;
            margin: 0 auto;
        }

        .breadcrumb {
            margin-bottom: 40px;
            font-size: 14px;
        }

        .breadcrumb a {
            color: var(--text-light);
            text-decoration: none;
        }

        .breadcrumb a:hover {
            color: var(--primary-color);
        }

        .breadcrumb span {
            color: var(--text-light);
            margin: 0 8px;
        }

        .product-detail {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 80px;
            background: white;
            border-radius: 16px;
            padding: 60px;
            box-shadow: var(--shadow-md);
            margin-bottom: 60px;
        }

        .product-gallery {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .main-image {
            width: 100%;
            height: 500px;
            border-radius: 16px;
            overflow: hidden;
            background: var(--bg-cream);
        }

        .main-image img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .thumbnail-images {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 12px;
        }

        .thumbnail {
            width: 100%;
            height: 100px;
            border-radius: 8px;
            overflow: hidden;
            cursor: pointer;
            border: 2px solid transparent;
            transition: var(--transition);
        }

        .thumbnail:hover {
            border-color: var(--primary-color);
        }

        .thumbnail.active {
            border-color: var(--primary-color);
        }

        .thumbnail img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .product-info {
            display: flex;
            flex-direction: column;
        }

        .product-badge-container {
            display: flex;
            gap: 12px;
            margin-bottom: 20px;
        }

        .badge {
            padding: 8px 16px;
            border-radius: 24px;
            font-size: 13px;
            font-weight: 500;
            background: var(--secondary-color);
            color: white;
        }

        .product-title {
            font-size: 36px;
            color: var(--text-dark);
            font-family: 'NIS Tak Narrow', 'Noto Serif JP', serif;
            margin-bottom: 16px;
            font-weight: 500;
            letter-spacing: 0.5px;
        }

        .product-subtitle {
            font-size: 16px;
            color: var(--text-light);
            margin-bottom: 32px;
            line-height: 1.8;
        }

        .product-price-section {
            background: var(--bg-light-green);
            padding: 32px;
            border-radius: 12px;
            margin-bottom: 32px;
        }

        .product-price {
            font-size: 42px;
            color: var(--primary-color);
            font-weight: 600;
            margin-bottom: 8px;
        }

        .product-unit {
            font-size: 16px;
            color: var(--text-medium);
        }

        .product-quantity {
            margin-bottom: 32px;
        }

        .quantity-label {
            font-size: 15px;
            font-weight: 600;
            color: var(--text-dark);
            margin-bottom: 12px;
            display: block;
        }

        .quantity-selector {
            display: flex;
            align-items: center;
            gap: 16px;
        }

        .quantity-btn-large {
            width: 48px;
            height: 48px;
            border: 2px solid var(--border-medium);
            background: white;
            border-radius: 8px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
            color: var(--text-dark);
            transition: var(--transition);
        }

        .quantity-btn-large:hover {
            border-color: var(--primary-color);
            color: var(--primary-color);
        }

        .quantity-input-large {
            width: 80px;
            text-align: center;
            padding: 12px;
            border: 2px solid var(--border-subtle);
            border-radius: 8px;
            font-size: 18px;
            font-weight: 600;
        }

        .add-to-cart-section {
            display: flex;
            gap: 16px;
            margin-bottom: 40px;
        }

        .add-to-cart-btn {
            flex: 1;
            padding: 18px 32px;
            background: var(--primary-color);
            color: white;
            border: none;
            border-radius: 8px;
            font-size: 17px;
            font-weight: 600;
            cursor: pointer;
            transition: var(--transition);
        }

        .add-to-cart-btn:hover {
            background: var(--primary-dark);
            transform: translateY(-2px);
            box-shadow: var(--shadow-md);
        }

        .favorite-btn {
            width: 60px;
            padding: 18px;
            background: white;
            border: 2px solid var(--border-medium);
            border-radius: 8px;
            font-size: 24px;
            cursor: pointer;
            transition: var(--transition);
        }

        .favorite-btn:hover {
            border-color: #ffd700;
            color: #ffd700;
        }

        .favorite-btn.active {
            color: #ffd700;
            border-color: #ffd700;
        }

        .product-features {
            list-style: none;
            padding: 0;
            margin-bottom: 32px;
        }

        .product-features li {
            padding: 12px 0;
            border-bottom: 1px solid var(--border-subtle);
            display: flex;
            align-items: center;
            gap: 12px;
            font-size: 15px;
            color: var(--text-medium);
        }

        .product-features li:last-child {
            border-bottom: none;
        }

        .feature-icon {
            font-size: 20px;
        }

        .product-description-section {
            background: white;
            border-radius: 16px;
            padding: 60px;
            box-shadow: var(--shadow-sm);
        }

        .section-tabs {
            display: flex;
            gap: 32px;
            border-bottom: 2px solid var(--border-subtle);
            margin-bottom: 40px;
        }

        .tab {
            padding: 16px 0;
            font-size: 16px;
            font-weight: 600;
            color: var(--text-light);
            border-bottom: 3px solid transparent;
            cursor: pointer;
            transition: var(--transition);
            margin-bottom: -2px;
        }

        .tab.active {
            color: var(--primary-color);
            border-bottom-color: var(--primary-color);
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .description-text {
            font-size: 16px;
            line-height: 2;
            color: var(--text-medium);
        }

        .description-text p {
            margin-bottom: 20px;
        }

        @media (max-width: 768px) {
            .product-page {
                padding: 80px 20px;
            }

            .product-detail {
                grid-template-columns: 1fr;
                gap: 40px;
                padding: 40px 30px;
            }

            .main-image {
                height: 400px;
            }

            .product-title {
                font-size: 28px;
            }

            .product-price {
                font-size: 32px;
            }

            .add-to-cart-section {
                flex-direction: column;
            }

            .favorite-btn {
                width: 100%;
            }

            .product-description-section {
                padding: 40px 30px;
            }
        }
    </style>
</head>
<body>
    <div class="product-page">
        <div class="product-container">
            <div class="breadcrumb">
                <a href="index.html">ãƒ›ãƒ¼ãƒ </a>
                <span>â€º</span>
                <a href="index.html#products">å•†å“ä¸€è¦§</a>
                <span>â€º</span>
                <span id="productBreadcrumb">ã»ã†ã‚Œã‚“è‰</span>
            </div>

            <div class="product-detail">
                <div class="product-gallery">
                    <div class="main-image">
                        <img src="image/seika/sample1.jpg" alt="ã»ã†ã‚Œã‚“è‰" id="mainImage">
                    </div>
                    <div class="thumbnail-images">
                        <div class="thumbnail active" onclick="changeImage('image/seika/sample1.jpg', 0)">
                            <img src="image/seika/sample1.jpg" alt="ã»ã†ã‚Œã‚“è‰ 1">
                        </div>
                        <div class="thumbnail" onclick="changeImage('image/seika/sample1.jpg', 1)">
                            <img src="image/seika/sample1.jpg" alt="ã»ã†ã‚Œã‚“è‰ 2">
                        </div>
                        <div class="thumbnail" onclick="changeImage('image/seika/sample1.jpg', 2)">
                            <img src="image/seika/sample1.jpg" alt="ã»ã†ã‚Œã‚“è‰ 3">
                        </div>
                        <div class="thumbnail" onclick="changeImage('image/seika/sample1.jpg', 3)">
                            <img src="image/seika/sample1.jpg" alt="ã»ã†ã‚Œã‚“è‰ 4">
                        </div>
                    </div>
                </div>

                <div class="product-info">
                    <div class="product-badge-container">
                        <span class="badge">ä»ŠæœŸ</span>
                        <span class="badge">ç„¡è¾²è–¬</span>
                    </div>

                    <h1 class="product-title" id="productTitle">ã»ã†ã‚Œã‚“è‰</h1>
                    <p class="product-subtitle" id="productSubtitle">ç”˜ã¿ãŒå¼·ãæ „é¤Šæº€ç‚¹ã€‚é‰„åˆ†ã‚„ãƒ“ã‚¿ãƒŸãƒ³ãŒè±Šå¯Œã§ã€å¥åº·çš„ãªé£Ÿç”Ÿæ´»ã‚’ã‚µãƒãƒ¼ãƒˆã—ã¾ã™ã€‚</p>

                    <div class="product-price-section">
                        <div class="product-price" id="productPrice">Â¥300</div>
                        <div class="product-unit" id="productUnit">ï¼ˆè¢‹ã‚ãŸã‚Šï¼‰</div>
                    </div>

                    <div class="product-quantity">
                        <label class="quantity-label">æ•°é‡</label>
                        <div class="quantity-selector">
                            <button class="quantity-btn-large" onclick="updateQuantity(-1)">âˆ’</button>
                            <input type="number" class="quantity-input-large" id="quantity" value="1" min="1" onchange="setQuantity(this.value)">
                            <button class="quantity-btn-large" onclick="updateQuantity(1)">ï¼‹</button>
                        </div>
                    </div>

                    <div class="add-to-cart-section">
                        <button class="add-to-cart-btn" onclick="addToCart()">ğŸ›’ ã‚«ãƒ¼ãƒˆã«è¿½åŠ </button>
                        <button class="favorite-btn" id="favoriteBtn" onclick="toggleFavorite()">â˜†</button>
                    </div>

                    <ul class="product-features">
                        <li><span class="feature-icon">ğŸŒ±</span> ç„¡è¾²è–¬ãƒ»ç„¡è‚¥æ–™æ ½åŸ¹</li>
                        <li><span class="feature-icon">ğŸŒ¾</span> è‡ªå®¶æ¡ç¨®</li>
                        <li><span class="feature-icon">ğŸ“¦</span> æ–°é®®é…é€ï¼ˆåç©«å¾Œå³ç™ºé€ï¼‰</li>
                        <li><span class="feature-icon">âœ¨</span> æ—¬ã®æ™‚æœŸï¼š10æœˆã€œ5æœˆ</li>
                    </ul>
                </div>
            </div>

            <div class="product-description-section">
                <div class="section-tabs">
                    <div class="tab active" onclick="switchTab('description')">å•†å“èª¬æ˜</div>
                    <div class="tab" onclick="switchTab('cultivation')">æ ½åŸ¹æ–¹æ³•</div>
                    <div class="tab" onclick="switchTab('shipping')">é…é€ã«ã¤ã„ã¦</div>
                </div>

                <div id="description" class="tab-content active">
                    <div class="description-text">
                        <p>å®‰ç©è‡ªç„¶è¾²åœ’ã§ä¸å¯§ã«è‚²ã¦ã‚‰ã‚ŒãŸã»ã†ã‚Œã‚“è‰ã§ã™ã€‚è‚¥æ–™ã‚„è¾²è–¬ã‚’ä¸€åˆ‡ä½¿ç”¨ã›ãšã€åœŸã¨ç¨®ã ã‘ã§è‚²ã¦ãŸè‡ªç„¶æ ½åŸ¹ã®ã»ã†ã‚Œã‚“è‰ã¯ã€é‡èœæœ¬æ¥ã®ç”˜ã¿ã¨æ „é¤ŠãŒãã£ã—ã‚Šè©°ã¾ã£ã¦ã„ã¾ã™ã€‚</p>
                        <p>è‘‰ãŒè‚‰åšã§æŸ”ã‚‰ã‹ãã€ã‚¢ã‚¯ãŒå°‘ãªã„ã®ãŒç‰¹å¾´ã§ã™ã€‚ãŠã²ãŸã—ã‚„ã‚½ãƒ†ãƒ¼ã€ã‚¹ãƒ ãƒ¼ã‚¸ãƒ¼ãªã©ã€æ§˜ã€…ãªæ–™ç†ã«ãŠä½¿ã„ã„ãŸã ã‘ã¾ã™ã€‚</p>
                        <p>é‰„åˆ†ã€ãƒ“ã‚¿ãƒŸãƒ³Aã€ãƒ“ã‚¿ãƒŸãƒ³Cã€ã‚«ãƒ«ã‚·ã‚¦ãƒ ãªã©ã®æ „é¤Šç´ ãŒè±Šå¯Œã§ã€å¥åº·ç¶­æŒã«å½¹ç«‹ã¡ã¾ã™ã€‚</p>
                    </div>
                </div>

                <div id="cultivation" class="tab-content">
                    <div class="description-text">
                        <p><strong>è‡ªå®¶æ¡ç¨®ã«ã‚ˆã‚‹ç¨®å–ã‚Š</strong><br>
                        æ¯å¹´ã€å„ªã‚ŒãŸæ ªã‹ã‚‰ç¨®ã‚’æ¡å–ã—ã€ãã®åœ°åŸŸã®æ°—å€™ã‚„åœŸå£Œã«é©å¿œã—ãŸå¼·ã„é‡èœã‚’è‚²ã¦ã¦ã„ã¾ã™ã€‚</p>
                        
                        <p><strong>ç„¡è‚¥æ–™ãƒ»ç„¡è¾²è–¬æ ½åŸ¹</strong><br>
                        åŒ–å­¦è‚¥æ–™ã‚„æœ‰æ©Ÿè‚¥æ–™ã‚‚ä½¿ç”¨ã›ãšã€åœŸä¸­ã®å¾®ç”Ÿç‰©ã®åŠ›ã‚’å€Ÿã‚Šã¦æ¤ç‰©ãŒè‡ªç„¶ã«æˆé•·ã™ã‚‹ç’°å¢ƒã‚’æ•´ãˆã¦ã„ã¾ã™ã€‚</p>
                        
                        <p><strong>é©æœŸæ’­ç¨®ã¨æ‰‹ä½œæ¥­ç®¡ç†</strong><br>
                        è‡ªç„¶ã®ãƒªã‚ºãƒ ã«åˆã‚ã›ãŸæ’­ç¨®æ™‚æœŸã‚’å®ˆã‚Šã€è‰å–ã‚Šã‚„é–“å¼•ããªã©ã™ã¹ã¦ã®ä½œæ¥­ã‚’æ‰‹ä½œæ¥­ã§ä¸å¯§ã«è¡Œã£ã¦ã„ã¾ã™ã€‚</p>
                    </div>
                </div>

                <div id="shipping" class="tab-content">
                    <div class="description-text">
                        <table style="width: 100%; border-collapse: collapse; margin-bottom: 20px;">
                            <tr style="border-bottom: 1px solid #e0e0e0;">
                                <th style="text-align: left; padding: 12px 8px; width: 140px; font-weight: 600;">é…é€æ–¹æ³•</th>
                                <td style="padding: 12px 8px;">ãƒ¤ãƒãƒˆé‹è¼¸ã‚¯ãƒ¼ãƒ«ä¾¿ï¼ˆå†·è”µï¼‰</td>
                            </tr>
                            <tr style="border-bottom: 1px solid #e0e0e0;">
                                <th style="text-align: left; padding: 12px 8px; font-weight: 600;">é€æ–™</th>
                                <td style="padding: 12px 8px;">å…¨å›½ä¸€å¾‹ Â¥500</td>
                            </tr>
                            <tr style="border-bottom: 1px solid #e0e0e0;">
                                <th style="text-align: left; padding: 12px 8px; font-weight: 600;">ç™ºé€æ—¥</th>
                                <td style="padding: 12px 8px;">æœˆãƒ»æ°´ãƒ»é‡‘æ›œæ—¥ï¼ˆåç©«å¾Œã€å½“æ—¥ç™ºé€ï¼‰</td>
                            </tr>
                            <tr style="border-bottom: 1px solid #e0e0e0;">
                                <th style="text-align: left; padding: 12px 8px; font-weight: 600;">æœ€ä½è³¼å…¥é‡‘é¡</th>
                                <td style="padding: 12px 8px;">Â¥4,500ä»¥ä¸Š</td>
                            </tr>
                            <tr style="border-bottom: 1px solid #e0e0e0;">
                                <th style="text-align: left; padding: 12px 8px; font-weight: 600;">é…é€æ—¥æ™‚æŒ‡å®š</th>
                                <td style="padding: 12px 8px;">å¯èƒ½ï¼ˆã”æ³¨æ–‡æ™‚ã®å‚™è€ƒæ¬„ã«ã”è¨˜å…¥ãã ã•ã„ï¼‰</td>
                            </tr>
                        </table>
                        
                        <div style="background: #f5f5f5; padding: 16px; border-radius: 4px; font-size: 0.9em;">
                            <p style="margin: 0 0 8px 0; font-weight: 600;">ã”æ³¨æ„äº‹é …</p>
                            <ul style="margin: 0; padding-left: 20px;">
                                <li>åç©«ã—ãŸã°ã‹ã‚Šã®æ–°é®®ãªé‡èœã‚’ãŠå±Šã‘ã™ã‚‹ãŸã‚ã€å—æ³¨å¾Œã«åç©«ãƒ»æ¢±åŒ…ãƒ»ç™ºé€ã‚’è¡Œã„ã¾ã™ã€‚</li>
                                <li>ã‚ˆã‚Šæ–°é®®ãªé‡èœã‚’ãŠå±Šã‘ã™ã‚‹ãŸã‚ã€ã™ã¹ã¦ã®é‡èœã¯æ°´æ´—ã„ã‚’ã—ã¦ãŠã‚Šã¾ã›ã‚“ã€‚</li>
                                <li>åç©«çŠ¶æ³ã«ã‚ˆã‚Šç™ºé€æ—¥ãŒå‰å¾Œã™ã‚‹å ´åˆãŒã”ã–ã„ã¾ã™ã€‚</li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script src="inventory-sync.js"></script>
    <script src="auth.js"></script>
    <script src="script.js"></script>
    <script>
        let quantity = 1;
        let currentProduct = null;

        // å•†å“ãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿è¾¼ã‚“ã§è¡¨ç¤º
        function loadProductData() {
            const urlParams = new URLSearchParams(window.location.search);
            const productId = urlParams.get('id') || 'v1';
            
            // PRODUCTSã‹ã‚‰å•†å“ã‚’æ¤œç´¢
            currentProduct = PRODUCTS.find(p => p.id === productId);
            
            if (!currentProduct) {
                currentProduct = PRODUCTS[0]; // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã§æœ€åˆã®å•†å“
            }
            
            // ãƒšãƒ¼ã‚¸ã‚¿ã‚¤ãƒˆãƒ«æ›´æ–°
            document.title = `${currentProduct.name} | å®‰ç©ç›´å£²æ‰€`;
            
            // ãƒ‘ãƒ³ããšæ›´æ–°
            document.getElementById('productBreadcrumb').textContent = currentProduct.name;
            
            // ãƒ¡ã‚¤ãƒ³ç”»åƒã¨ã‚µãƒ ãƒã‚¤ãƒ«æ›´æ–°
            document.getElementById('mainImage').src = currentProduct.img;
            document.getElementById('mainImage').alt = currentProduct.name;
            
            // å•†å“æƒ…å ±æ›´æ–°
            document.getElementById('productTitle').textContent = currentProduct.name;
            document.getElementById('productSubtitle').textContent = currentProduct.description;
            document.getElementById('productPrice').textContent = `Â¥${currentProduct.price}`;
            document.getElementById('productUnit').textContent = `ï¼ˆ${currentProduct.unit}ã‚ãŸã‚Šï¼‰`;
            
            // ãƒãƒƒã‚¸æ›´æ–°
            const badgeContainer = document.querySelector('.product-badge-container');
            badgeContainer.innerHTML = `
                <span class="badge">${currentProduct.period}</span>
                <span class="badge">ç„¡è¾²è–¬</span>
            `;
            
            // æ—¬ã®æœˆè¡¨ç¤º
            const seasonText = currentProduct.seasonMonths.map(m => `${m}æœˆ`).join('ãƒ»');
            const featuresList = document.querySelector('.product-features');
            featuresList.innerHTML = `
                <li><span class="feature-icon">ğŸŒ±</span> ç„¡è¾²è–¬ãƒ»ç„¡è‚¥æ–™æ ½åŸ¹</li>
                <li><span class="feature-icon">ğŸŒ¾</span> è‡ªå®¶æ¡ç¨®</li>
                <li><span class="feature-icon">ğŸ“¦</span> æ–°é®®é…é€ï¼ˆåç©«å¾Œå³ç™ºé€ï¼‰</li>
                <li><span class="feature-icon">âœ¨</span> æ—¬ã®æ™‚æœŸï¼š${seasonText}</li>
            `;
        }

        function changeImage(src, index) {
            document.getElementById('mainImage').src = src;
            document.querySelectorAll('.thumbnail').forEach((thumb, i) => {
                thumb.classList.toggle('active', i === index);
            });
        }

        function updateQuantity(change) {
            quantity = Math.max(1, quantity + change);
            document.getElementById('quantity').value = quantity;
        }

        function setQuantity(value) {
            quantity = Math.max(1, parseInt(value) || 1);
            document.getElementById('quantity').value = quantity;
        }

        function addToCart() {
            if (!currentProduct) return;
            
            // ãƒ­ã‚°ã‚¤ãƒ³ãƒã‚§ãƒƒã‚¯
            if (!window.Auth || !window.Auth.isLoggedIn()) {
                if (confirm('ã‚«ãƒ¼ãƒˆã‚’åˆ©ç”¨ã™ã‚‹ã«ã¯ãƒ­ã‚°ã‚¤ãƒ³ãŒå¿…è¦ã§ã™ã€‚\nãƒ­ã‚°ã‚¤ãƒ³ãƒšãƒ¼ã‚¸ã¸ç§»å‹•ã—ã¾ã™ã‹ï¼Ÿ')) {
                    window.location.href = 'login.html?redirect=product.html?id=' + currentProduct.id;
                }
                return;
            }
            
            // ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ åœ¨åº«å–å¾—
            const inventory = window.InventorySync ? window.InventorySync.get(currentProduct.id) : { stock: 0 };
            const currentStock = inventory.stock || 0;
            
            // åœ¨åº«ãƒã‚§ãƒƒã‚¯
            if (currentStock === 0) {
                alert(`ç”³ã—è¨³ã”ã–ã„ã¾ã›ã‚“ã€‚${currentProduct.name}ã¯ç¾åœ¨åœ¨åº«åˆ‡ã‚Œã§ã™ã€‚`);
                return;
            }
            
            // ã‚«ãƒ¼ãƒˆãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—
            let cartItems = JSON.parse(localStorage.getItem('cartItems') || '[]');
            
            // æ—¢å­˜ã®ã‚«ãƒ¼ãƒˆã‚¢ã‚¤ãƒ†ãƒ ã‚’ç¢ºèª
            const existingItem = cartItems.find(item => item.id === currentProduct.id);
            const currentCartQuantity = existingItem ? existingItem.quantity : 0;
            const newQuantity = currentCartQuantity + quantity;
            
            // åœ¨åº«æ•°ã‚’è¶…ãˆãªã„ã‹ãƒã‚§ãƒƒã‚¯
            if (newQuantity > currentStock) {
                alert(`ç”³ã—è¨³ã”ã–ã„ã¾ã›ã‚“ã€‚${currentProduct.name}ã®åœ¨åº«ãŒä¸è¶³ã—ã¦ã„ã¾ã™ã€‚\nç¾åœ¨ã®åœ¨åº«ï¼š${currentStock}å€‹\nã‚«ãƒ¼ãƒˆå†…ï¼š${currentCartQuantity}å€‹\nã”å¸Œæœ›æ•°ï¼š${quantity}å€‹`);
                return;
            }
            
            // ã‚«ãƒ¼ãƒˆã«è¿½åŠ 
            if (existingItem) {
                existingItem.quantity = newQuantity;
            } else {
                cartItems.push({
                    id: currentProduct.id,
                    name: currentProduct.name,
                    price: currentProduct.price,
                    unit: currentProduct.unit,
                    image: currentProduct.img,
                    description: currentProduct.description,
                    quantity: quantity,
                    stock: currentStock
                });
            }
            
            localStorage.setItem('cartItems', JSON.stringify(cartItems));
            alert(`ã‚«ãƒ¼ãƒˆã«è¿½åŠ ã—ã¾ã—ãŸï¼\nå•†å“: ${currentProduct.name}\næ•°é‡: ${quantity}å€‹`);
        }

        function toggleFavorite() {
            const urlParams = new URLSearchParams(window.location.search);
            const productId = urlParams.get('id') || 'v1';
            
            let favorites = JSON.parse(localStorage.getItem('favorites') || '[]');
            const btn = document.getElementById('favoriteBtn');
            
            const index = favorites.indexOf(productId);
            if (index > -1) {
                favorites.splice(index, 1);
                btn.textContent = 'â˜†';
                btn.classList.remove('active');
            } else {
                favorites.push(productId);
                btn.textContent = 'â˜…';
                btn.classList.add('active');
            }
            
            localStorage.setItem('favorites', JSON.stringify(favorites));
        }

        // ãƒšãƒ¼ã‚¸èª­ã¿è¾¼ã¿æ™‚ã«å®Ÿè¡Œ
        window.addEventListener('DOMContentLoaded', function() {
            // å•†å“ãƒ‡ãƒ¼ã‚¿èª­ã¿è¾¼ã¿
            loadProductData();
            
            // ãŠæ°—ã«å…¥ã‚ŠçŠ¶æ…‹ã‚’åæ˜ 
            const urlParams = new URLSearchParams(window.location.search);
            const productId = urlParams.get('id') || 'v1';
            const favorites = JSON.parse(localStorage.getItem('favorites') || '[]');
            const btn = document.getElementById('favoriteBtn');
            
            if (favorites.includes(productId)) {
                btn.textContent = 'â˜…';
                btn.classList.add('active');
            }
        });

        function switchTab(tabName) {
            document.querySelectorAll('.tab').forEach(tab => {
                tab.classList.remove('active');
            });
            document.querySelectorAll('.tab-content').forEach(content => {
                content.classList.remove('active');
            });
            
            event.currentTarget.classList.add('active');
            document.getElementById(tabName).classList.add('active');
        }
    </script>
</body>
</html>
